
@{
    ViewBag.Title = "EditUser";
    Layout = "~/Views/Shared/_Layout.cshtml";
    web.Models.UserViewModel model = Model as web.Models.UserViewModel;
    List<Domain.Model.MRKeHu> kehus = model.Kehus;
    Domain.Model.User user = model.UserModel;
}
<div class="wrapper wrapper-content animated fadeInRight">

    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <form class="form-horizontal m-t">
                        <input type="hidden" id="Id" name="Id" value="@user.Id" />
                        <div class="form-group">
                            <label class="col-sm-3 control-label">用户名：</label>
                            <div class="col-sm-8">
                                <input type="text" value="@user.UserName" name="UserName" disabled readonly placeholder="" id="UserName" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">店铺：</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="Store" id="Store" disabled>
                                    <option value="">请选择</option>
                                    @foreach (var item in kehus)
                                    {
                                        <option value="@item.KHDM" @(user.StoreNumber == item.KHDM ? "selected" : "")>@item.KHMC</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">角色：</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="RoleName" id="RoleName" disabled >
                                    <option value="">请选择</option>
                                    <option value="超级管理员" @(user.RoleName == "超级管理员" ? "selected" : "")>超级管理员</option>
                                    <option value="店铺管理员" @(user.RoleName == "店铺管理员" ? "selected" : "")>店铺管理员</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">密码：</label>
                            <div class="col-sm-8">
                                <input id="Password" value="@user.Password" type="Password" class="form-control" name="url">
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-3">
                                <button class="btn btn-primary" type="button" id="updateuser">提交</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>

</div>


@section scripts{
    <script type="text/javascript">
        $(function () {
            $("#Store").change(function () {
                var storeNumber = $('#Store option:selected').val();
                $("#UserName").val(storeNumber);
            })
            $("#updateuser").click(function () {
                var id = $("#Id").val();
                var username = $("#UserName").val();
                var password = $("#Password").val();
                var rolename = $("#RoleName").val();
                var storenumber = $('#Store option:selected').val();//选中的值
                var storename = $('#Store option:selected').text();//选中的文本
                if (username.length == 0) {
                    alert("请输入用户名"); return false;
                }
                if (password.length == 0) {
                    alert("请输入密码"); return false;
                }
                if (rolename.length == 0) {
                    alert("请选择角色"); return false;
                }
                if (storenumber.length == 0) {
                    alert("请选择店铺"); return false;
                }

                $.post("/user/edituser?id="+id, {
                    "Id": id,
                    "UserName": username,
                    "Password": password,
                    "RoleName": rolename,
                    "StoreNumber": storenumber,
                    "StoreName": storename
                }, function (data) {
                    if (data.Success) {
                        alert("修改成功");
                        window.parent.location.reload();
                    } else {
                        alert(data.ErrorMessage)
                    }
                })
            })
        })
    </script>
}