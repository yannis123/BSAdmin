
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    web.Models.UserViewModel model = Model as web.Models.UserViewModel;

    List<Domain.Model.MRKeHu> kehus = model.Kehus;
    List<Domain.Model.User> users = model.Users;
}

<div class="wrapper wrapper-content  animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox">
                <div class="ibox-content">

                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            添加账户
                        </div>
                        <div class="panel-body">
                            <form role="form" class="form-inline">
                                <div class="form-group">
                                    <label for="RoleName" class="control-label">角色:</label>
                                    <select class="form-control" name="RoleName" id="RoleName">
                                        <option value="">请选择</option>
                                        <option value="超级管理员">超级管理员</option>
                                        <option value="店铺管理员">店铺管理员</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="exampleInputPassword2" class="control-label">店铺:</label>
                                    <select class="form-control" name="Store" id="Store">
                                        <option value="">请选择</option>
                                        @foreach (var item in kehus)
                                        {
                                            <option value="@item.KHDM">@item.KHMC</option>
                                        }
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="UserName" class="control-label">用户名:</label>
                                    <input type="text" name="UserName" placeholder="" id="UserName" class="form-control">
                                </div>
                             

                                <div class="form-group">
                                    <label for="Password" class="control-label">密码:</label>
                                    <input type="password" name="Password" placeholder="请输入密码" id="Password" class="form-control">
                                </div>


                                <button class="btn btn-white" type="button" id="adddianyuan">添加</button>
                            </form>
                        </div>

                    </div>

                    <div class="clients-list">

                        <ul class="nav nav-tabs">

                            <li class="active">
                                <a data-toggle="tab" href="#tab-1"><i class="fa fa-user"></i> 超级管理员</a>
                            </li>
                            <li class="">
                                <a data-toggle="tab" href="#tab-2"><i class="fa fa-users"></i> 店铺管理员</a>
                            </li>

                        </ul>

                        <div class="tab-content">
                            <div id="tab-1" class="tab-pane active">
                                <div class="full-height-scroll">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <tbody>
                                                @foreach (var item in users.Where(m => m.UserType == 1))
                                                {
                                                    <tr>
                                                        <td class="client-avatar"></td>
                                                        <td>
                                                            <a data-toggle="tab" class="client-link">@item.UserName</a>
                                                        </td>
                                                        <td> @item.StoreName</td>

                                                        <td> @item.CreateTime.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                                        <td><a class="label label-primary" onclick="app.shwdialog('修改账号', '/user/edituser?id=@(item.Id)')">修改</a> </td>
                                                    </tr>
                                                }

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div id="tab-2" class="tab-pane">
                                <div class="full-height-scroll">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <tbody>
                                                @foreach (var item in users.Where(m => m.UserType == 2))
                                                {
                                                    <tr>
                                                        <td class="client-avatar"></td>
                                                        <td>
                                                            <a data-toggle="tab" class="client-link">@item.UserName</a>
                                                        </td>
                                                        <td> @item.StoreName</td>

                                                        <td> @item.CreateTime.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                                        <td><a class="label label-primary" onclick="app.shwdialog('修改账号', '/user/edituser?id=@(item.Id)')">修改</a> </td>
                                                    </tr>
                                                }

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

@section scripts{
    <script type="text/javascript">
        $(function () {
            $("#RoleName").change(function () {
                var rolename = $('#RoleName option:selected').val();
                if (rolename == "店铺管理员") {
                    $("#UserName").val("");
                    $("#UserName").attr("disabled", "disabled")
                } else {
                    $("#UserName").val("");
                    $("#UserName").removeAttr("disabled")
                    $("#UserName").attr("placeholder", "请输入用户名")
                }
            })

            $("#Store").change(function () {
                var rolename = $('#RoleName option:selected').val();
                if (rolename == "店铺管理员") {
                    var storeNumber = $('#Store option:selected').val();
                    $("#UserName").val(storeNumber);
                }
            })

            $("#adddianyuan").click(function () {
                var username = $("#UserName").val();
                var password = $("#Password").val();
                var rolename = $("#RoleName").val();
                var storenumber = $('#Store option:selected').val();//选中的值
                var storename = $('#Store option:selected').text();//选中的文本
                if (username.length == 0) {
                    alert("请输入用户名"); return false;
                }
                if (password.length == 0) {
                    alert("请输入密码"); return false;
                }
                if (rolename.length == 0) {
                    alert("请选择角色"); return false;
                }
                if (storenumber.length == 0) {
                    alert("请选择店铺"); return false;
                }

                $.post("/user/adduser", {
                    "UserName": username,
                    "Password": password,
                    "RoleName": rolename,
                    "StoreNumber": storenumber,
                    "StoreName": storename
                }, function (data) {
                    if (data.Success) {
                        alert("添加成功");
                        window.location.reload();
                    } else {
                        alert(data.ErrorMessage)
                    }
                })
            })
        })
    </script>
}